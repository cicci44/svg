<svg id="rotatingGear" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">
  <!-- Kugghjul -->
  <g id="gear">
    <circle cx="50" cy="50" r="20" fill="#4A90E2" stroke="#2E5C8A" stroke-width="2"/>
    
    <!-- Kugg-tänder -->
    <rect x="48" y="10" width="4" height="15" fill="#2E5C8A" rx="1"/>
    <rect x="48" y="75" width="4" height="15" fill="#2E5C8A" rx="1"/>
    <rect x="10" y="48" width="15" height="4" fill="#2E5C8A" rx="1"/>
    <rect x="75" y="48" width="15" height="4" fill="#2E5C8A" rx="1"/>
    
    <rect x="23" y="23" width="4" height="15" fill="#2E5C8A" rx="1" transform="rotate(45 50 50)"/>
    <rect x="23" y="62" width="4" height="15" fill="#2E5C8A" rx="1" transform="rotate(-45 50 50)"/>
    <rect x="62" y="23" width="4" height="15" fill="#2E5C8A" rx="1" transform="rotate(-45 50 50)"/>
    <rect x="62" y="62" width="4" height="15" fill="#2E5C8A" rx="1" transform="rotate(45 50 50)"/>
    
    <circle cx="50" cy="50" r="8" fill="#fff" stroke="#2E5C8A" stroke-width="2"/>
  </g>
  
  <script>
    <![CDATA[
    //!export-start
    let _pb_rotating = false;
    let _pn_speed = 2;
    //!export-end
    
    let rotationAngle = 0;
    let rotationInterval = null;
    
    function putValue(id, value) {
      if (id === '_pb_rotating') {
        _pb_rotating = value;
        if (value) {
          startRotation();
        } else {
          stopRotation();
        }
      }
      if (id === '_pn_speed') {
        _pn_speed = value;
      }
    }
    
    function postValue(id, value) {
      console.error('Not defined!');
    }
    
    function startRotation() {
      if (rotationInterval) return;
      
      const gear = document.getElementById('gear');
      rotationInterval = setInterval(() => {
        const checkDestroy = document.getElementById('rotatingGear');
        if (!checkDestroy) {
          stopRotation();
          return;
        }
        
        rotationAngle += _pn_speed;
        if (rotationAngle >= 360) rotationAngle = 0;
        gear.setAttribute('transform', `rotate(${rotationAngle} 50 50)`);
      }, 50);
    }
    
    function stopRotation() {
      if (rotationInterval) {
        clearInterval(rotationInterval);
        rotationInterval = null;
      }
    }
    
    // MutationObserver för att städa upp
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.removedNodes.forEach((node) => {
          if (node.id === 'rotatingGear') {
            stopRotation();
            observer.disconnect();
          }
        });
      });
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
    ]]>
  </script>
</svg>